<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
   <meta name="format-detection" content="telephone=no" />
   <meta name="msapplication-tap-highlight" content="no" />
   <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
   <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
	<title>My ToDo List</title>
	<script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
	<script type="text/javascript">

		var db;
		
		// Create a reference to the database
		function getDatabase() {
			return window.openDatabase("todoListDB", "1.0", "ToDoList Database", 200000);
		}
		
		// Run a select statement to pull out all records
		function getItems() {
			db.transaction(function(tx) {
				tx.executeSql('SELECT * FROM MYLIST', [], querySuccess, databaseError);
			}, databaseError);
		}
		
		// Process the SQLResultSetList
		function querySuccess(tx, results) {
			var len = results.rows.length;
			var output = '';
			for (var i=0; i<len; i++){
				output = output + '<li id="' + results.rows.item(i).id + '">' + results.rows.item(i).list_action + '</li>';
			}
			$('#message').html('<p>There are ' + len + ' items in your list:</p>');
			$('#listItems').html('<ul>' + output + '</ul>');
		}
		
		// Insert a record into the database
		function insertItem() {
			var insertValue =	$("input:text[name=list_action]").val();
			db.transaction(function(tx) {
				tx.executeSql('INSERT INTO MYLIST (list_action) VALUES ("' + insertValue + '")');
			}, databaseError, getItems);
			// Clear the value from the input box
			$("input:text[name=list_action]").val("");
		}
		
		// Database error handler
		function databaseError(error) {
			$('#message').html("SQL Error: " + error.code);
		}
		
		// Run the onDeviceReady method
		document.addEventListener("deviceready", onDeviceReady, false);

		function onDeviceReady(){
		
			$('#saveItem').click(function() {
				insertItem();
			});
		
			db = getDatabase();
			db.transaction(function(tx) {
				tx.executeSql('DROP TABLE IF EXISTS MYLIST');
				tx.executeSql('CREATE TABLE IF NOT EXISTS MYLIST (id INTEGER PRIMARY KEY AUTOINCREMENT, list_action)');
			}, databaseError, getItems);
			
		}
	</script>
</head>
<body>
	<h1>My ToDo List</h1>
	<input type="text" name="list_action" />
	<button id="saveItem">Grabar</button>
	<div id="message"></div>
	<div id="listItems"></div>
</body>
</html>